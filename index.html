<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Starlight SL Playground</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .top {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .panel {
      flex: 1;
      padding: 10px;
      box-sizing: border-box;
      overflow: auto;
      border-right: 1px solid #ddd;
    }

    #output {
      border-right: none;
      border-left: 1px solid #ddd;
      background: #f9f9f9;
    }

    textarea {
      width: 100%;
      height: 100%;
      font-family: monospace;
      font-size: 14px;
      resize: none;
    }

    .bottom {
      height: 200px;
      border-top: 2px solid #ddd;
      padding: 10px;
      overflow: auto;
      background: #111;
      color: #0f0;
      font-family: monospace;
      font-size: 13px;
    }

    button {
      padding: 10px 20px;
      border: none;
      background: black;
      color: white;
      cursor: pointer;
      margin: 10px;
    }
  </style>
</head>
<body>

  <button onclick="runDSL()">â–¶ Run DSL</button>

  <div class="top">
    <!-- DSL INPUT -->
    <div class="panel">
      <h3>DSL Input</h3>
      <textarea id="dsl">
StyleSheet {
  container: { padding: 20, backgroundColor: "#f5f5f5" }
  title: { fontSize: 24, color: "blue" }
  button: { padding: 10, backgroundColor: "black", color: "white" }
}

SLContainer style={styles.container} {
  SLTitle style={styles.title} "Welcome to Starlight"
  SLLabel "Enter your name:"
  SLTextField onInput={e => setUsername(e.target.value)}
  SLButton style={styles.button} onClick={handleClick} "Click Me"
  SLLabel "Hello, {username}!"
}
      </textarea>
    </div>

    <!-- RENDERED OUTPUT -->
    <div class="panel" id="output">
      <h3>Rendered SL Output</h3>
      <div id="app"></div>
    </div>
  </div>

  <!-- COMPILED JS -->
  <div class="bottom">
    <h3>Compiled JavaScript</h3>
    <pre id="compiled"></pre>
  </div>

  <script type="module">
    import HTMLCompiler from "./html-compiler.js";
    import * as Core from "./compiler.js";

    window.runDSL = function () {
      const dsl = document.getElementById("dsl").value;

      const compiler = new HTMLCompiler();
      let compiledCode;
      try {
        compiledCode = compiler.compile(dsl);
      } catch (err) {
        document.getElementById("compiled").textContent = err.message;
        document.getElementById("app").innerHTML = `<pre style="color:red">${err.message}</pre>`;
        return;
      }

      document.getElementById("compiled").textContent = compiledCode;

      const app = document.getElementById("app");
      app.innerHTML = "";

      try {
        const runtime = Core;

        let username = "";

        function setUsername(val) {
          username = val;
          runDSL(); // re-render on input
        }

        function handleClick() {
          alert(`Hello, ${username || "Guest"}!`);
        }

        let styles = {};

        const func = new Function(
          ...Object.keys(runtime),
          "styles",
          "username",
          "setUsername",
          "handleClick",
          `return ${compiledCode}`
        );

        const vnode = func(
          ...Object.values(runtime),
          styles,
          username,
          setUsername,
          handleClick
        );

        const dom = runtime.renderElement(vnode);
        app.appendChild(dom);

      } catch (e) {
        app.innerHTML = `<pre style="color:red">${e.message}</pre>`;
        console.error(e);
      }
    };

    // Initial render
    runDSL();
  </script>

</body>
</html>
