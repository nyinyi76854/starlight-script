<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Starlight DSL Playground</title>

  <style>
    body {
      margin: 0;
      font-family: Arial;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .top {
      display: flex;
      flex: 1;
    }

    .panel {
      flex: 1;
      padding: 10px;
      box-sizing: border-box;
      overflow: auto;
    }

    textarea {
      width: 100%;
      height: 100%;
      font-family: monospace;
      font-size: 14px;
    }

    #output {
      border-left: 2px solid #ddd;
    }

    .bottom {
      height: 200px;
      border-top: 2px solid #ddd;
      padding: 10px;
      overflow: auto;
      background: #111;
      color: #0f0;
      font-family: monospace;
      font-size: 13px;
    }

    button {
      padding: 10px;
      border: none;
      background: black;
      color: white;
      cursor: pointer;
    }
  </style>
</head>

<body>

<button onclick="runDSL()">â–¶ Run DSL</button>

<div class="top">

  <!-- DSL INPUT -->
  <div class="panel">
    <h3>DSL Input</h3>
    <textarea id="dsl">
let username = "User"

function handleClick() {
  alert("Hello " + username)
}

StyleSheet {
  container: {
    padding: 20,
    backgroundColor: "#eee"
  },
  title: {
    fontSize: 22,
    color: "blue"
  },
  button: {
    padding: 10,
    backgroundColor: "black",
    color: "white"
  }
}

div style={styles.container} {
  h1 style={styles.title} "Welcome"
  p "Hello, {username}!"
  button style={styles.button} onClick={handleClick} "Click Me"
}
    </textarea>
  </div>

  <!-- OUTPUT -->
  <div class="panel" id="output">
    <h3>Rendered Output</h3>
    <div id="app"></div>
  </div>

</div>

<!-- COMPILED JS -->
<div class="bottom">
  <h3>Compiled JavaScript</h3>
  <pre id="compiled"></pre>
</div>

<script type="module">
import HTMLCompiler from "./html-compiler.js";
import {
  createElement,
  render,
  signal,
  mountComponent,
  renderElement,
  useState,
  effect,
  registerRoute,
  navigate,
  Router,
  renderToString,
  hydrate,
  defineComponent,
  Builder,
  useEffect,
  useLayoutEffect,
  useCleanup,
  useAnimation,
  animate,
  useGesture,
  Fragment,
  Portal,
  Suspense,
  lazy,
  createContext,
  useContext,
  cloneElement,
  isValidElement,
  mergeProps,
  useFetch,
  useResource,
  createStore,
  useDebug,
  DevTools,
  SuspenseBoundary,
  Link,
  Redirect,
  useParams,
  useQuery,
  spring,
  transition,
  useTransition,
  useForm,
  useField,
  Form,
  Input,
  TextArea,
  Select,
  memo,
  forwardRef,
  useRef,
  ErrorBoundary,
  renderToNodeStream,
  hydrateRoot,
  Profiler,
  useLogger,
  DevInspector,
  batch,
  nextTick,
  isServer,
  isClient,
  SuspenseList,
  lazyWithPreload,
  useReducer,
  useStore,
  useSpring,
  useTransitionGroup,
  useDrag,
  useSwipe,
  useImperativeHandle,
  lazyComponentWrapper,
  withErrorBoundary,
  renderToStaticMarkup,
  hydrateStreaming,
  traceUpdates,
  useProfiler,
  classNames,
  mergeStyles,
  composeRefs,
  useHistory,
  useLocation,
  useMatch,
  RedirectTo,
  useMemo,
  useCallback,
  useDeferredValue,
  useId,
  motion,
  AnimatePresence,
  catchError,
  onError,
  useValidator,
  Controller,
  traceRenders,
  useInspector,
  useSafeAreaInsets,
  useKeyboard,
  Dimensions,
  cloneVNode,
  shallowEqual,
  defer,
  StyleSheet
} from "./compiler.js";

window.runDSL = function () {
  const dsl = document.getElementById("dsl").value;

  const compiler = new HTMLCompiler();
  const compiled = compiler.compile(dsl);

  document.getElementById("compiled").textContent = compiled;

  const app = document.getElementById("app");
  app.innerHTML = "";

  try {

    const func = new Function(
      "createElement",
      "render",
      "signal",
      "mountComponent",
      "renderElement",
      "useState",
      "effect",
      "registerRoute",
      "navigate",
      "Router",
      "renderToString",
      "hydrate",
      "defineComponent",
      "Builder",
      "useEffect",
      "useLayoutEffect",
      "useCleanup",
      "useAnimation",
      "animate",
      "useGesture",
      "Fragment",
      "Portal",
      "Suspense",
      "lazy",
      "createContext",
      "useContext",
      "cloneElement",
      "isValidElement",
      "mergeProps",
      "useFetch",
      "useResource",
      "createStore",
      "useDebug",
      "DevTools",
      "SuspenseBoundary",
      "Link",
      "Redirect",
      "useParams",
      "useQuery",
      "spring",
      "transition",
      "useTransition",
      "useForm",
      "useField",
      "Form",
      "Input",
      "TextArea",
      "Select",
      "memo",
      "forwardRef",
      "useRef",
      "ErrorBoundary",
      "renderToNodeStream",
      "hydrateRoot",
      "Profiler",
      "useLogger",
      "DevInspector",
      "batch",
      "nextTick",
      "isServer",
      "isClient",
      "SuspenseList",
      "lazyWithPreload",
      "useReducer",
      "useStore",
      "useSpring",
      "useTransitionGroup",
      "useDrag",
      "useSwipe",
      "useImperativeHandle",
      "lazyComponentWrapper",
      "withErrorBoundary",
      "renderToStaticMarkup",
      "hydrateStreaming",
      "traceUpdates",
      "useProfiler",
      "classNames",
      "mergeStyles",
      "composeRefs",
      "useHistory",
      "useLocation",
      "useMatch",
      "RedirectTo",
      "useMemo",
      "useCallback",
      "useDeferredValue",
      "useId",
      "motion",
      "AnimatePresence",
      "catchError",
      "onError",
      "useValidator",
      "Controller",
      "traceRenders",
      "useInspector",
      "useSafeAreaInsets",
      "useKeyboard",
      "Dimensions",
      "cloneVNode",
      "shallowEqual",
      "defer",
      "StyleSheet",
      `
      let styles = {};
      ${compiled}
      return typeof tree !== "undefined" ? tree : null;
      `
    );

    const vnode = func(
      createElement,
      render,
      signal,
      mountComponent,
      renderElement,
      useState,
      effect,
      registerRoute,
      navigate,
      Router,
      renderToString,
      hydrate,
      defineComponent,
      Builder,
      useEffect,
      useLayoutEffect,
      useCleanup,
      useAnimation,
      animate,
      useGesture,
      Fragment,
      Portal,
      Suspense,
      lazy,
      createContext,
      useContext,
      cloneElement,
      isValidElement,
      mergeProps,
      useFetch,
      useResource,
      createStore,
      useDebug,
      DevTools,
      SuspenseBoundary,
      Link,
      Redirect,
      useParams,
      useQuery,
      spring,
      transition,
      useTransition,
      useForm,
      useField,
      Form,
      Input,
      TextArea,
      Select,
      memo,
      forwardRef,
      useRef,
      ErrorBoundary,
      renderToNodeStream,
      hydrateRoot,
      Profiler,
      useLogger,
      DevInspector,
      batch,
      nextTick,
      isServer,
      isClient,
      SuspenseList,
      lazyWithPreload,
      useReducer,
      useStore,
      useSpring,
      useTransitionGroup,
      useDrag,
      useSwipe,
      useImperativeHandle,
      lazyComponentWrapper,
      withErrorBoundary,
      renderToStaticMarkup,
      hydrateStreaming,
      traceUpdates,
      useProfiler,
      classNames,
      mergeStyles,
      composeRefs,
      useHistory,
      useLocation,
      useMatch,
      RedirectTo,
      useMemo,
      useCallback,
      useDeferredValue,
      useId,
      motion,
      AnimatePresence,
      catchError,
      onError,
      useValidator,
      Controller,
      traceRenders,
      useInspector,
      useSafeAreaInsets,
      useKeyboard,
      Dimensions,
      cloneVNode,
      shallowEqual,
      defer,
      StyleSheet
    );

    const dom = renderElement(vnode);
    app.appendChild(dom);

  } catch (e) {
    app.innerHTML = "<pre style='color:red'>" + e.message + "</pre>";
    console.error(e);
  }
};
</script>

</body>
</html>
